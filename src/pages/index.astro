---
import Header from '../components/Header.astro';
---

<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Formulário</title>
  </head>
  <body>
    <Header title="Formulário" />

    <h1 class="margin-right">Bem-vindo!</h1>

    <form id="userForm" method="POST">
      <div>
        <label for="name" class="form-label">Qual o seu nome completo?</label>
        <input type="text" name="name" placeholder="Seu nome completo..." class="form-input" required>
      </div>

      <div>
        <label for="age" class="form-label">Qual a sua idade? (Importante)</label>
        <input type="number" name="age" placeholder="Sua idade..." class="form-input" required>
      </div>

      <div>
        <p class="form-label">Qual o seu gênero?</p>
        <div class="form-radio">
          <div>
            <input type="radio" id="man" name="gender" value="man" required>
            <label for="man">Homem</label>
          </div>
          <div>
            <input type="radio" id="woman" name="gender" value="woman">
            <label for="woman">Mulher</label>
          </div>
        </div>
      </div>

      <button type="submit" class="form-button">Começar formulário</button>
      <sub>Se não carregar, recarregue a página...</sub>
    </form>

    <div id="load"></div>

    <script>
      const form = document.getElementById('userForm');
      const loadContainer = document.getElementById('load');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        loadContainer.textContent = 'Enviando dados...';

        const formData = new FormData(form);
        console.log('Dados enviados:', Object.fromEntries(formData));

        try {
          const response = await fetch('/api/form', {
            method: 'POST',
            body: formData
          });

          const result = await response.json();
          console.log(result);

          if (result.success) {
            loadContainer.textContent = '✅ Dados enviados com sucesso!';
            setTimeout(() => {
              const infos = Object.fromEntries(formData);
              const path = infos.gender === 'man' ? '/formMan' : '/formWoman';
              window.location.href = path;
            }, 2000);
          } else {
            loadContainer.textContent = '❌ Erro ao enviar dados: ' + result.error;
          }
        } catch (err) {
          console.error('Erro no fetch:', err);
          loadContainer.textContent = '❌ Erro ao enviar dados.';
        }
      });
    </script>
  </body>
</html>
